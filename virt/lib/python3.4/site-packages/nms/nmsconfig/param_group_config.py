#!/usr/bin/env python3

# This is proprietary software.
# Part of cluster monitoring project.
# PEP8 codestyle used, python version 3.
#
# authors: dmitry khodakov <dmitryhd@gmail.com>
# date: 29.10.2014
#
# pylint: disable=C0330, C0326, C0301, C0103

""" List of all parameter groups. """

import re
# ---------------------------------------------------------------------------
# Begin of server configuration
# ---------------------------------------------------------------------------

SYSTEM_CONFIG = {}
SYSTEM_CONFIG['PortNumber'] = {}
SYSTEM_CONFIG['PortNumber']['Host'] = 7
SYSTEM_CONFIG['PortNumber']['1810'] = 26
SYSTEM_CONFIG['PortNumber']['1810m'] = 24  # m is for monitoring
SYSTEM_CONFIG['PortNumber']['1910'] = 9
SYSTEM_CONFIG['PortNumber']['5800'] = 28
MaxSwitchPorts = max(SYSTEM_CONFIG['PortNumber'].values())

SYSTEM_CONFIG['CpuNumber'] = {}
SYSTEM_CONFIG['CpuNumber']['Server'] = 24
SYSTEM_CONFIG['CpuNumber']['ControlServer'] = 64
SYSTEM_CONFIG['CpuNumber']['GPUServer'] = 32
MaxProcNumber = max(SYSTEM_CONFIG['CpuNumber'].values())

# ----------------------------------------------------------------------------
# Parameter groups
# ----------------------------------------------------------------------------

ParamGroupInit = {'GPUServerBMC':['CPU1_DTS_Temp', 'CPU2_DTS_Temp', 'M_Card_Area_Temp', 'LAN_Area_Temp',
                              'MB_Inlet_temp',
                              'CPU1_DIMM_A0', 'CPU1_DIMM_B0', 'CPU1_DIMM_C0', 'CPU1_DIMM_D0',
                              'CPU2_DIMM_A0', 'CPU2_DIMM_B0', 'CPU2_DIMM_C0', 'CPU2_DIMM_D0',
                              'CPU0_VCore',   'CPU1_VCore',
                              'CPU0_Memory',  'CPU1_Memory',
                              '3_3V',          '5V',            '12V',              'VBAT',
                              'SYS_FAN_1', 'SYS_FAN_2', 'SYS_FAN_3', 'SYS_FAN_4', 'SYS_FAN_5', 'SYS_FAN_6',
                              'PSU1_Power', 'PSU2_Power', 'PSU3_Power'],

              'GPU':         ['GPU0_Temp', 'GPU1_Temp', 'GPU2_Temp', 'GPU3_Temp', 'GPU4_Temp', 'GPU5_Temp', 'GPU6_Temp',
                              'GPU7_Temp',
                              'GPU0_Memory', 'GPU1_Memory', 'GPU2_Memory', 'GPU3_Memory', 'GPU4_Memory', 'GPU5_Memory', 'GPU6_Memory',
                              'GPU7_Memory'],

              'rPDU':        ['LoadStatus',       'DeviceLoad',       'PowerConsumpted',
                              'Phase1LoadStatus', 'Phase2LoadStatus', 'Phase3LoadStatus',
                              'Phase1Current',    'Phase2Current',    'Phase3Current',
                              'Phase1Voltage',    'Phase2Voltage',    'Phase3Voltage',
                              'Phase1Power',      'Phase2Power',      'Phase3Power'],

              'rPDU_7921':   ['LoadStatus_7921',  'DeviceLoad_7921'],

              'CpuVolt':     ['VCORE1', 'VCORE2', 'VCORE3', 'VCORE4'],

              'CpuTemp':     ['CpuTemp1', 'CpuTemp2', 'CpuTemp3', 'CpuTemp4'],

              'Fan':         ['PSU1_Fan1', 'PSU1_Fan2', 'PSU2_Fan1', 'PSU2_Fan2',
                              'FRNT_FAN1', 'FRNT_FAN2', 'FRNT_FAN3', 'FRNT_FAN4', 'FRNT_FAN5'],

              'RdTemp1':     ['OnBoardTemp1_CtrlA1', 'OnBoardTemp1_CtrlB1', 'OnBoardTemp2_CtrlA1',
                              'OnBoardTemp2_CtrlB1', 'OnBoardTemp3_CtrlA1', 'OnBoardTemp3_CtrlB1',
                              'DiskCtrlTemp_CtrlA1', 'DiskCtrlTemp_CtrlB1', 'MemCtrlTemp_CtrlA1',
                              'MemCtrlTemp_CtrlB1'],

              'RdTemp2':     ['OnBoardTemp1_CtrlA2', 'OnBoardTemp1_CtrlB2', 'OnBoardTemp2_CtrlA2',
                              'OnBoardTemp2_CtrlB2', 'OnBoardTemp3_CtrlA2', 'OnBoardTemp3_CtrlB2',
                              'DiskCtrlTemp_CtrlA2', 'DiskCtrlTemp_CtrlB2', 'MemCtrlTemp_CtrlA2',
                              'MemCtrlTemp_CtrlB2'],

              'SnsTemp':     ['sensor_t01', 'sensor_t02', 'sensor_t03', 'sensor_t04'],

              'SnsHum' :     ['sensor_h01', 'sensor_h02', 'sensor_h03', 'sensor_h04'],

              'SnsLck' :     ['sensor_l01', 'sensor_l02'],
             }

GroupDescription = {'CpuVolt': ['Voltage on Cpu',         'Напряжение на ЦП'               ],
                    'CpuTemp': ['Temperature on Cpu',     'Температура ЦП'                 ],
                    'GPU':     ['GPU Parameters',         'Параметры ГП'                    ],
                    'Fan':     ['Fans',                   'Вентиляторы'                     ],
                    'RdTemp1': ['Temperature inside hull','Температура внутри корпуса'      ],
                    'SnsTemp': ['Temperatire on sensors', 'Показания температурных сенсоров'],
                    'SnsHum':  ['Humidity on sensors',    'Показания сенсоров влажности'    ],
                    'SnsLck':  ['Door lock state',        'Состояние двери'                 ],
                    'EthSt':   ['Network status',         'Состояние сети'                  ],
                    'EthID':   ['Network in discards',    'Отброшенные пакеты на входе'     ],
                    'EthIE':   ['Network in errors',      'Ошибки на входе'                 ],
                    'EthOO':   ['Network out octets',     'Отправленные октеты'             ],
                    'EthOD':   ['Network out discards',   'Отброшенные пакеты на выходе'    ],
                    'EthOE':   ['Network out errors',     'Ошибки на выходе'                ],
                    'EthQue':  ['Network queue length',   'Длина очереди сети'              ],
                    'sw1810St':['Network status',         'Статус сети'                     ],
                    }

# Format: param_group_name, system_config_device_name
CPU_INIT = [('ServerCpu', 'Server'),
            ('GPUServerCpu', 'GPUServer'),
            ('ControlServerCpu', 'ControlServer'),
           ]

for  param_group_name, system_config_device_name in CPU_INIT:
    ParamGroupInit[param_group_name] = []
    max_cpu_num = SYSTEM_CONFIG['CpuNumber'][system_config_device_name] + 1
    for cpu_num in range(1, max_cpu_num):
        ParamGroupInit[param_group_name].append(
                'usage_cpu_core_' + str(cpu_num))


# Fill network interface parameters:
# ---------------------------------------------------------------------------
network_interface_config = []

host_interface_gr_name = {'EthSt': 'sw_oper_status_',
                                                'EthIO': 'sw_in_octets_',
                                                'EthID': 'sw_in_discards_',
                                                'EthIE': 'sw_in_errors_',
                                                'EthOO': 'sw_out_octets_',
                                                'EthOD': 'sw_out_discards_',
                                                'EthOE': 'sw_out_errors_',
                                                'EthQue': 'sw_queue_len_',
                                                }
network_interface_config.append((SYSTEM_CONFIG['PortNumber']['Host'], host_interface_gr_name))
sw1810_interface_gr_name = {'sw1810St': 'sw_oper_status_',
                                                      'sw1810IO': 'sw_in_octets_',
                                                      'sw1810ID': 'sw_in_discards_',
                                                      'sw1810IE': 'sw_in_errors_',
                                                      'sw1810OO': 'sw_out_octets_',
                                                      'sw1810OD': 'sw_out_discards_',
                                                      'sw1810OE': 'sw_out_errors_',
                                                      'sw1810Que': 'sw_queue_len_',
                                                      }
# Monitoring 1810 doesn't have queue lenght
sw1810m_interface_gr_name = {'sw1810St': 'sw_oper_status_',
                                                      'sw1810IO': 'sw_in_octets_',
                                                      'sw1810ID': 'sw_in_discards_',
                                                      'sw1810IE': 'sw_in_errors_',
                                                      'sw1810OO': 'sw_out_octets_',
                                                      'sw1810OD': 'sw_out_discards_',
                                                      'sw1810OE': 'sw_out_errors_',
                                                      }
network_interface_config.append((SYSTEM_CONFIG['PortNumber']['1810'], sw1810_interface_gr_name))
network_interface_config.append((SYSTEM_CONFIG['PortNumber']['1810m'], sw1810m_interface_gr_name))
sw1910_interface_gr_name = {'sw1910St': 'sw_oper_status_',
                                                      'sw1910IO': 'sw_in_octets_',
                                                      'sw1910ID': 'sw_in_discards_',
                                                      'sw1910IE': 'sw_in_errors_',
                                                      'sw1910OO': 'sw_out_octets_',
                                                      'sw1910OD': 'sw_out_discards_',
                                                      'sw1910OE': 'sw_out_errors_',
                                                      'sw1910Que': 'sw_queue_len_',
                                                     }
network_interface_config.append((SYSTEM_CONFIG['PortNumber']['1910'], sw1910_interface_gr_name))
sw5800_interface_gr_name = {'sw5800St': 'sw_oper_status_',
                                                      'sw5800IO': 'sw_in_octets_',
                                                      'sw5800ID': 'sw_in_discards_',
                                                      'sw5800IE': 'sw_in_errors_',
                                                      'sw5800OO': 'sw_out_octets_',
                                                      'sw5800OD': 'sw_out_discards_',
                                                      'sw5800OE': 'sw_out_errors_',
                                                      'sw5800Que': 'sw_queue_len_',
                                                     }
network_interface_config.append((SYSTEM_CONFIG['PortNumber']['5800'], sw5800_interface_gr_name))

for port_number, network_param in network_interface_config:
    for name, param_name in network_param.items():
        ParamGroupInit[name] = []
        for index in range(1, port_number + 1):
            ParamGroupInit[name].append(param_name + str(index))

ParamGroupRus={}
ParamGroupRus['ControlServerCpu'] = "ЦП сервера управления"
ParamGroupRus['ServerCpu']        = "ЦП сервера"
ParamGroupRus['GPUServerCpu']        = "ЦП сервера"
ParamGroupRus['EthQue']           = "Очередь на интерфейсах"
ParamGroupRus['CpuVolt']           = "Напряжение на ЦП"

ParamGroupRus['sw5800St' ]        = "Состояние коммутатора HP-5800"
ParamGroupRus['sw5800IO' ]        = "Число принятых октетов, коммутатор HP-5800"
ParamGroupRus['sw5800ID' ]        = "Число отброшенных входящих пакетов, коммутатор HP-5800"
ParamGroupRus['sw5800IE' ]        = "Число ошибочных входящих пакетов, коммутатор HP-5800"
ParamGroupRus['sw5800OO' ]        = "Число отправленных октетов, коммутатор HP-5800"
ParamGroupRus['sw5800OD' ]        = "Число отброшенных исходящих пакетов, коммутатор HP-5800"
ParamGroupRus['sw5800OE' ]        = "Число ошибочных исходящих пакетов, коммутатор HP-5800"
ParamGroupRus['sw5800Que']        = "Число пакетов в очереди, коммутатор HP-5800"

ParamGroupRus['sw1910St' ]        = "Состояние коммутатора HP-1910"
ParamGroupRus['sw1910IO' ]        = "Число принятых октетов, коммутатор HP-1910"
ParamGroupRus['sw1910ID' ]        = "Число отброшенных входящих пакетов, коммутатор HP-1910"
ParamGroupRus['sw1910IE' ]        = "Число ошибочных входящих пакетов, коммутатор HP-1910"
ParamGroupRus['sw1910OO' ]        = "Число отправленных октетов, коммутатор HP-1910"
ParamGroupRus['sw1910OD' ]        = "Число отброшенных исходящих пакетов, коммутатор HP-1910"
ParamGroupRus['sw1910OE' ]        = "Число ошибочных исходящих пакетов, коммутатор HP-1910"
ParamGroupRus['sw1910Que']        = "Число пакетов в очереди, коммутатор HP-1910"

ParamGroupRus['sw1810St' ]        = "Состояние коммутатора HP-1810"
ParamGroupRus['sw1810IO' ]        = "Число принятых октетов, коммутатор HP-1810"
ParamGroupRus['sw1810ID' ]        = "Число отброшенных входящих пакетов, коммутатор HP-1810"
ParamGroupRus['sw1810IE' ]        = "Число ошибочных входящих пакетов, коммутатор HP-1810"
ParamGroupRus['sw1810OO' ]        = "Число отправленных октетов, коммутатор HP-1810"
ParamGroupRus['sw1810OD' ]        = "Число отброшенных исходящих пакетов, коммутатор HP-1810"
ParamGroupRus['sw1810OE' ]        = "Число ошибочных исходящих пакетов, коммутатор HP-1810"
ParamGroupRus['sw1810Que']        = "Число пакетов в очереди, коммутатор HP-1810"

ParamGroupRus['EthSt' ]        = "Состояние интерфейсов"
ParamGroupRus['EthIO' ]        = "Число принятых октетов"
ParamGroupRus['EthID' ]        = "Число отброшенных входящих пакетов"
ParamGroupRus['EthIE' ]        = "Число ошибочных входящих пакетов"
ParamGroupRus['EthOO' ]        = "Число отправленных октетов"
ParamGroupRus['EthOD' ]        = "Число отброшенных исходящих пакетов"
ParamGroupRus['EthOE' ]        = "Число ошибочных исходящих пакетов"
ParamGroupRus['EthQue']        = "Число пакетов в очереди"

ParamGroupRus['GPUServerBMC']  = 'Данные датчиков, подключенных к BMC расчетного сервера'
ParamGroupRus['GPU'         ]  = 'Графические процессоры'
ParamGroupRus['rPDU'        ]  = 'Распределитель питания'
ParamGroupRus['rPDU_7921'   ]  = 'Распределитель питания'
ParamGroupRus['CpuVolt'     ]  = 'Напряжение на ЦП'
ParamGroupRus['CpuTemp'     ]  = 'Температура ЦП'
ParamGroupRus['Fan'         ]  = 'Вентиляторы'
ParamGroupRus['RdTemp1'     ]  = 'Температурные датчики RAID-массива №1'
ParamGroupRus['RdTemp2'     ]  = 'Температурные датчики RAID-массива №2'
ParamGroupRus['SnsTemp'     ]  = 'Датчики температуры в стойке'
ParamGroupRus['SnsHum'      ]  = 'Датчики влажности в стойке'
ParamGroupRus['SnsLck'      ]  = 'Датчики дверей'

# ---------------------------------------------------------------------------
# Parameter Lists config
# ---------------------------------------------------------------------------

# Here goes list of parameters names for devices

PARAMETER_LISTS = {}

PARAMETER_LISTS['ServerParamList'] = []
PARAMETER_LISTS['ServerParamList'].extend(ParamGroupInit['EthIO'])
PARAMETER_LISTS['ServerParamList'].extend(ParamGroupInit['EthID'])
PARAMETER_LISTS['ServerParamList'].extend(ParamGroupInit['EthIE'])
PARAMETER_LISTS['ServerParamList'].extend(ParamGroupInit['EthOO'])
PARAMETER_LISTS['ServerParamList'].extend(ParamGroupInit['EthOD'])
PARAMETER_LISTS['ServerParamList'].extend(ParamGroupInit['EthOE'])
PARAMETER_LISTS['ServerParamList'].extend(ParamGroupInit['EthQue'])
PARAMETER_LISTS['ServerParamList'].extend(ParamGroupInit['EthSt'])
PARAMETER_LISTS['ServerParamList'].extend(['memTotalReal',
                        'memOccupiedReal',
                        'memCachedReal',
                        'memFreeReal',
                        'memFreePercent',
                        'diskOccupied',
                        'diskOccupiedBytes',
                        'cpuUser',
                        'diskTotalBytes',
                        'diskBlockSize',
                        'diskTotal',
                        'online'])

for index in range(1, SYSTEM_CONFIG['CpuNumber']['Server'] + 1):
    name = "usage_cpu_core_{}".format(index)
    PARAMETER_LISTS['ServerParamList'].append(name)

PARAMETER_LISTS['GPUServerParamList'] = []
PARAMETER_LISTS['GPUServerParamList'].extend(['memTotalReal',
                        'memOccupiedReal',
                        'memCachedReal',
                        'memFreeReal',
                        'memFreePercent',
                        'diskOccupied',
                        'diskOccupiedBytes',
                        'cpuUser',
                        'diskTotalBytes',
                        'diskBlockSize',
                        'diskTotal',
                        'online'])
for index in range(1, SYSTEM_CONFIG['CpuNumber']['GPUServer'] + 1):
    name = "usage_cpu_core_{}".format(index)
    PARAMETER_LISTS['GPUServerParamList'].append(name)
PARAMETER_LISTS['GPUServerParamList'].extend(ParamGroupInit['GPU'])


PARAMETER_LISTS['ControlServAdditionalParamList'] = []
for index in range(SYSTEM_CONFIG['CpuNumber']['Server'] + 2,
                   SYSTEM_CONFIG['CpuNumber']['ControlServer'] + 1):
    name = "usage_cpu_core_{}".format(index)
    PARAMETER_LISTS['ControlServAdditionalParamList'].append(name)

PARAMETER_LISTS['FileServerParamList'] = ['diskOccupiedRaid1',
                        'diskOccupiedBytesRaid1',
                        'diskTotalBytesRaid1',
                        'diskBlockSizeRaid1',
                        'diskTotalRaid1',
                        'diskOccupiedRaid2',
                        'diskOccupiedBytesRaid2',
                        'diskTotalBytesRaid2',
                        'diskBlockSizeRaid2',
                        'diskTotalRaid2',]

PARAMETER_LISTS['ControlServerBmcParamList'] = []
PARAMETER_LISTS['ControlServerBmcParamList'].extend(ParamGroupInit['CpuVolt'])
PARAMETER_LISTS['ControlServerBmcParamList'].extend(ParamGroupInit['CpuTemp'])
PARAMETER_LISTS['ControlServerBmcParamList'].extend(ParamGroupInit['Fan'])
PARAMETER_LISTS['ControlServerBmcParamList'].append('online')
PARAMETER_LISTS['ControlServerBmcParamList'].append('online_bmc')

PARAMETER_LISTS['MonitoringServerBmcParamList'] = ["VCORE1",
                                "VCORE2",
                                "CpuTemp1",
                                "CpuTemp2",
                                "FRNT_FAN1",
                                "FRNT_FAN2",
                                "FRNT_FAN3",
                                "FRNT_FAN4",
                                'online',
                                'online_bmc'
                                ]

PARAMETER_LISTS['Raid01ParamList'] = ParamGroupInit['RdTemp1']
PARAMETER_LISTS['Raid02ParamList'] = ParamGroupInit['RdTemp2']
PARAMETER_LISTS['Raid01ParamList'].append('online')
PARAMETER_LISTS['Raid02ParamList'].append('online')

PARAMETER_LISTS['Ups01ParamList'] = ['batCharge',
                  'batRunTime',
                  'online']

PARAMETER_LISTS['GPUServerBMCParamList'] = ParamGroupInit['GPUServerBMC'] + ['online'] + ['online_bmc']

PARAMETER_LISTS['rPDUParamList'] = ParamGroupInit['rPDU'] + ['online']

PARAMETER_LISTS['rPDU_7921_ParamList'] = ParamGroupInit['rPDU_7921'] + ['online']

PARAMETER_LISTS['NetBootzParamList'] = ParamGroupInit['SnsTemp'] + ParamGroupInit['SnsHum'] + ParamGroupInit['SnsLck']
PARAMETER_LISTS['NetBootzParamList'].append('online')

PARAMETER_LISTS['Switch1910ParamList'] = []
for param_gr_name in sw1910_interface_gr_name:
    for param_name in ParamGroupInit[param_gr_name]:
        PARAMETER_LISTS['Switch1910ParamList'].append(param_name)
PARAMETER_LISTS['Switch1910ParamList'].append('online')

PARAMETER_LISTS['Switch1810ParamList'] = []
for param_gr_name in sw1810_interface_gr_name:
    for param_name in ParamGroupInit[param_gr_name]:
        PARAMETER_LISTS['Switch1810ParamList'].append(param_name)
PARAMETER_LISTS['Switch1810ParamList'].append('online')

PARAMETER_LISTS['Switch1810ParamList_short'] = []
for param_gr_name in sw1810m_interface_gr_name:
    for param_name in ParamGroupInit[param_gr_name]:
        if param_name[:13] != 'sw_queue_len_' and int(re.search(r'(\d+)', param_name).groups()[0])<26:
            PARAMETER_LISTS['Switch1810ParamList_short'].append(param_name)
PARAMETER_LISTS['Switch1810ParamList_short'].append('online')

PARAMETER_LISTS['Switch5800ParamList'] = []
for param_gr_name in sw5800_interface_gr_name:
    for param_name in ParamGroupInit[param_gr_name]:
        PARAMETER_LISTS['Switch5800ParamList'].append(param_name)
PARAMETER_LISTS['Switch5800ParamList'].append('online')

