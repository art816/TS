#!/usr/bin/env python3

# This is proprietary software.
# Part of cluster monitoring project.
# PEP8 codestyle used, python version 3.
#
# authors: dmitry khodakov <dmitryhd@gmail.com>
# date: 29.10.2014
#
# pylint: disable=C0103
# C0103 - for invalid constant names, used pep8 name convention (lower_case).

""" Module for configuration of nms software. """

from sqlalchemy import Float, TEXT, Boolean
import logging
import os

IS_PRODUCTION = False

# Logging
LOG_PATH = '/var/log/nms/'
LOG_FORMAT = '%(asctime)-30s %(levelname)s %(message)s'
CUR_LOG_LEVEL = logging.WARNING
LOG_MAX_SIZE = 50 * 1024 * 1024  # 50 MB.
BX_FILE = os.path.expanduser('~/bx_output/bx_queue')
BX_INFO_FILE = os.path.expanduser('~/bx_output/bx_info')
BX_SCHEDULE_FILE = os.path.expanduser('~/bx_output/bx_schedule')
BX_SO_LIST_FILE = os.path.expanduser('~/bx_output/bx_so_list')
BX_STATUS_FILE = os.path.expanduser('~/bx_output/bx_status')
LOG_NAME = 'nms_central'
WEB_LOG_LEVEL = logging.WARNING

# Timeouts (seconds)
SNMP_TIMEOUT = 4.0
IPMI_TIMEOUT = 1.0
PING_TIMEOUT = 0.2
DHCP_OFF_TIMEOUT = 60
DHCP_CHECK_TIMEOUT = 0.5
MOUNT_POINT_TIMEOUT = 0.5
POWER_CONTROLLER_TIMEOUT = 0.5
COLLECT_INTERVAL = 20
DEFAULT_RUNNER_TIMEOUT = 15

# Protocols
ALLOWED_PROTOCOLS = ('snmp', 'ipmi', 'calc', 'icmp')

# Web settings
WEB_THREADS = True
ALERTS_ON_PAGE = 50
TIME_FORMAT = '%H:%M:%S %d %B %Y'
WEB_DEBUG = True  # Disable this at production.
WEB_IP = '0.0.0.0'  # For everyone.
ALERT_DESCRIPTION = {'offline': 'Устройство недоступно',
                     'low': 'Низкое значение параметра',
                     'high': 'Высокое значение параметра'}

# Hardware settings
GPU_NUMBER = 8  # Number of gpu on each node

# Additional time, shown on plot, when view alert information.
PLOT_ALERT_ADDITIONAL_TIME_DOWN = 60  # in seconds
PLOT_ALERT_ADDITIONAL_TIME_UP = 60  # in seconds

# Parameters
PARAM_DEFAULT_REGEXP = r':\s(.+)\n'
PARAM_REGEXPS = {'int': r':\D*(\d+)\D*\n',
                 'float': r':\D*(\d+\.*\d*)\D*\n',
                 'str': r':\s(.+)\n'}
DEFAULT_COLLECT_INTERVAL = 5
DEFAULT_SIGNIFICANT_DIGITS = 2

# Database settings
POOL_SIZE = 2
DB_ECHO = False
DB_POOL_ECHO = False
DB_NAME_DEFAIULT = 'nms_localhost_db'
DB_HOST = '127.0.0.1'
DB_USER = 'root'
DB_PASSWD = '111111'
DB_TYPES = {"int": Float, "float": Float, "str": TEXT, "bool": Boolean}
DB_ALERTS_TABLE = 'recent_alerts'
DB_OLD_ALERTS_TABLE = 'old_alerts'
ALLOWED_CONSECUTIVE_FAILED_WRITES_TO_DB = 5
LAST_ONLINE_TABLE = 'last_online'
ADMIN_STATUS_TABLE = 'admin_status'
DB_TYPE = 'mysql'
DB_DIR = 'databases'
MAXIMUM_RECORS_IN_QUERY = 10**7
if DB_TYPE == 'mysql':
    DB_PREFIX_NAME = 'mysql+pymysql://{}:{}@{}'.format(
        DB_USER, DB_PASSWD, DB_HOST)
elif DB_TYPE == 'sqlite':
    DB_PREFIX_NAME = 'sqlite:///' + DB_DIR
else:
    assert False, 'wrong db type' + DB_TYPE

# Burka specific:
SYSTEM_NAME = 'buer'

CONTEXT_PATH = {'localhost': 'nms.contexts.localhost_context',
                'burka': 'nms.contexts.burka_context',
                'buer': 'nms.contexts.buer_context',
                'bussol': 'nms.contexts.bussol_context'}

CONTEXT_DB = {'localhost': 'nms_localhost_db',
              'burka': 'nms_burka_db',
              'buer': 'nms_buer_new_db',
              'bussol': 'nms_bussol_db'}

IS_ONLINE_VISIBLE = True

# Dictionary to map device name to ip address in network.
addressing = {'ControlServer': "csu.s",
              'ControlServerBMC': "csu_bmc.s",
              'MonitoringServer': "csm.s",
              'MonitoringServerBMC': "csm_bmc.s",
              'FileServer01': "fs_1.s",
              'FileServer02': "fs_2.s",
              'FileServer01BMC': "fs_1_bmc.s",
              'FileServer02BMC': "fs_2_bmc.s",
              'RAID01A': "raid1_a.s",
              'RAID01B': "raid1_b.s",
              'RAID02A': "raid2_a.s",
              'RAID02B': "raid2_b.s",
              'Switch1810_24_monitoring': "serv_sw_u.s",
              'Switch1810_24_gpu': "serv_sw_1.s",
              'Switch1910_8': "eng_sw.e",
              'Switch5800': "calc_sw.c",
              'NetBootzModule01': 'rmu_u.s',
              'NetBootzModule02': 'rmu_1.s',
              # Bussol pdu
              #'rPDU01': 'pdua_u.s',
              #'rPDU02': 'pdub_u.s',
              #'rPDU03': 'pdua_1.s',
              #'rPDU04': 'pdub_1.s',
              # Buer pdu
              'rPDU01': 'pdu1.s',
              'rPDU02': 'pdu2.s',
              'rPDU03': 'pdu3.s',
              'rPDU04': 'pdu4.s',
              'test_device': '127.0.0.1',
              'GPUServer01': 'node_1.s',
              'GPUServer02': 'node_2.s',
              'GPUServer03': 'node_3.s',
              'GPUServer04': 'node_4.s',
              'GPUServer05': 'node_5.s',
              'GPUServer06': 'node_6.s',
              'GPUServer07': 'node_7.s',
              'GPUServerBMC01': 'node_1_bmc.s',
              'GPUServerBMC02': 'node_2_bmc.s',
              'GPUServerBMC03': 'node_3_bmc.s',
              'GPUServerBMC04': 'node_4_bmc.s',
              'GPUServerBMC05': 'node_5_bmc.s',
              'GPUServerBMC06': 'node_6_bmc.s',
              'GPUServerBMC07': 'node_7_bmc.s',
              #'FileServer01Work': "FS_1.c",
              #'FileServer02Work': "FS_2.c",
              #'MonitoringServerWork': "CSM.c",
              #'ControlServerWork': "CSU.c",
              #'GPUServer01Work': 'node_1.c',
              #'GPUServer02Work': 'node_2.c',
              #'GPUServer03Work': 'node_3.c',
              #'GPUServer04Work': 'node_4.c',
              #'GPUServer05Work': 'node_5.c',
              #'GPUServer06Work': 'node_6.c',
              #'GPUServer07Work': 'node_7.c',
             }

TYAN_CREDENTIALS = {'login': 'user', 'passwd': '111111',
                    'ipmi_user': 'root', 'ipmi_passwd': 'superuser'}
CREDENTIALS = {
    'node1': TYAN_CREDENTIALS,
    'node2': TYAN_CREDENTIALS,
    'node3': TYAN_CREDENTIALS,
    'node4': TYAN_CREDENTIALS,
    'node5': TYAN_CREDENTIALS,
    'node6': TYAN_CREDENTIALS
}

# general device name: {'pdu_name': [1, 2 ,3] # outlet_numbers}
OUTLETS = {
    'MonitoringServer': {'rPDU03': [14], 'rPDU04': [14]},
    'ServerRaspred': {'rPDU03': [13], 'rPDU04': [13]},
    'FileServer': {'rPDU03': [12], 'rPDU04': [12]},
    'node1': {'rPDU01': [21, 22, 23]},
    'node1': {'rPDU01': [21, 22, 23]},
    'node1': {'rPDU01': [21, 22, 23]},
    'node2': {'rPDU02': [21, 22, 23]},
    'node3': {'rPDU01': [13, 14, 15]},
    'node4': {'rPDU02': [13, 14, 15]},
    'node5': {'rPDU01': [1, 2, 3]},
    'node6': {'rPDU02': [1, 2, 3]},
}
